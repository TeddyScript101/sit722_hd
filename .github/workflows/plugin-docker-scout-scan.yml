name: Plugin - Docker Scout Scan

on:
  workflow_dispatch:
  workflow_call:
    inputs:
      IMAGE_NAME:
        required: true
        type: string
      IMAGE_TAG:
        required: true
        type: string

jobs:
  scout-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Login to Docker Hub
        run: |
          echo ${{ secrets.DOCKERHUB_PASSWORD }} | docker login -u ${{ secrets.DOCKERHUB_USERNAME }} --password-stdin

      - name: Install Docker Scout CLI
        run: |
          if ! docker scout version &>/dev/null; then
            echo "Installing Docker Scout..."
            curl -fsSL https://get.docker.com/scout/install.sh | sh
          fi

      - name: Scan Docker Image
        run: |
          docker scout cves --format sarif --output scout-report.sarif.json ${{ inputs.IMAGE_NAME }}:${{ inputs.IMAGE_TAG }}
          echo "âœ… Docker Scout scan completed"
